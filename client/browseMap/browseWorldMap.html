<template name="browseWorldMap">

<script>
	function allowDrop(ev) {
	    ev.preventDefault();
	}

	function drag(ev) {

	    ev.dataTransfer.setData("text", ev.target.id);

	    //ev.dataTransfer.setData("url", ev.target.src);
	}

	function drop(ev) {


	    ev.preventDefault();

	    var map = display.ctl["MAP"].browseWorldMap.map;

	    var x = 0;
	    var y = 0;

		if(navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {
		     
			x = ev.layerX;
			y = ev.layerY;
		}
		else {

			x = ev.offsetX;
			y = ev.offsetY;
		}

	    var _long = map.stageXToLongitude( x );

	    var _lat = map.stageYToLatitude( y );

		var image = new AmCharts.MapImage();

		image.latitude = _lat;
        image.longitude = _long;

        image.width = 64;
        image.height = 64;

		var _id = ev.dataTransfer.getData("text");

		var sel = "#" + _id;

		var _dt = $(sel).attr("data-text");

		image.balloonText = $(sel).attr("title");

        image.imageURL = $(sel).attr("src");

  
        map.dataProvider.images.push(image);
        map.validateData();   

        var _ticket = game.user.getTicket( display.ctl["MAP"].browseWorldMap.selectedCountry.get() );

        _ticket.addTag(_long, _lat, _dt ); 

        db.updateUserHacks();
	    

	}
</script>

	<!--div class="tagClearButton">
		<button class="btn btn-danger" id="tagClear">CLEAR</button>
	</div-->

	<div style="position: relative; float: left; top: 55px; width:10%;">

		<div id="browseWorldIcon">
			<img class="topMapIcon" src="all_icon.png">
		</div>

		<div id="browseContinentIcon" class="mapLevel" >
			<img class="mapIcon" id="mapIconContinent" src="{{continentIcon}}"> 
			<div class="areaLabel" id="continentLabel">{{continentName}}</div>
		</div>

		<div id="browseRegionIcon" class="mapLevel">
			<img class="mapIcon" id="mapIconRegion" src="{{regionIcon}}"> 
			<span class="areaLabel" id="regionLabel" style="top: {{labelYCorrection}}">{{regionName}}</span>
		</div>

	</div>


	<div id="browseDivMap"  ondrop="drop(event)" ondragover="allowDrop(event)" style="float: left; position: relative; top: 55px; width: {{mapWidth}}px; height: {{mapHeight}}px; border-radius: 7px; border: 4px solid; border-color: gray;">
	</div>  

	<!--div class="mapTags" style="position: relative; top: 55px; width:8%;">

		{{#each tag}}

			<div>
				<img class="imgMapTag"   draggable="true" ondragstart="drag(event)"  data-text="{{this.dt}}" id="{{this._id}}" src="{{getTagURL}}" title="{{getText}}">
			</div>
		
		{{/each}}


	</div-->

	<div class="browseMapMessages" id="browseMapMessageBox">PICK A COUNTRY TO EXPLORE</div>

	<!--button class="btn btn-default mapCloseButton" id="browseMapClose">X</button-->


</template>




 